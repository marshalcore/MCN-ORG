<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MCN-NG | Existing Officer Verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Base Styles */
    body {
      font-family: "Open Sans", sans-serif;
      background-color: #fffcf4;
      margin: 0;
      padding: 0;
    }

    .layout_padding {
      padding: 75px 0;
    }

    .footer_section {
      background-color: #254a93;
      color: #fff;
      text-align: center;
      padding: 20px 0;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }

    .contact_form-container input,
    .contact_form-container textarea,
    .contact_form-container select {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .contact_form-container button {
      background-color: #254a93;
      color: #fff;
      border: none;
      padding: 15px 30px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 18px;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-top: 20px;
      width: 100%;
    }

    .contact_form-container button:hover {
      background-color: #1a3570;
    }

    .header-container {
      background-color: #d32f2f;
      color: #fff;
      position: relative;
      padding: 20px 40px;
    }

    .header-logo {
      position: absolute;
      top: 20px;
      left: 40px;
    }

    .header-logo img {
      height: 110px;
      max-width: 200px;
      width: auto;
      object-fit: contain;
      filter: brightness(1.4) contrast(1.2);
      display: block;
    }

    .header-rc {
      position: absolute;
      top: 20px;
      right: 40px;
      font-size: 18px;
      font-weight: bold;
      color: #ffffff;
    }

    .header-title {
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      padding-top: 50px;
      padding-bottom: 10px;
      color: #ffffff;
    }

    .header-subtitle {
      text-align: center;
      font-size: 1.2rem;
      padding-bottom: 20px;
      color: #ffffff;
    }

    @media (max-width: 768px) {
      .header-logo,
      .header-rc {
        position: static;
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
      }

      .header-title {
        font-size: 1.5rem;
        padding: 10px 0;
      }

      .header-subtitle {
        font-size: 1rem;
        padding: 10px 0;
      }

      .header-logo img {
        height: 60px;
      }
    }

    .page-loader {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      font-size: 1.2rem;
      font-weight: bold;
      color: #1f233e;
    }
    
    .section-container {
      display: none;
    }
    
    .active-section {
      display: block;
    }
    
    #verificationMessage {
      color: #d32f2f;
      margin-top: 10px;
      text-align: center;
      font-weight: bold;
    }
    
    .success-message {
      color: green;
      margin-top: 10px;
      font-weight: bold;
    }
    
    .error-message {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }

    .status-message {
      background-color: #f8f9fa;
      border-left: 4px solid #254a93;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    .verification-banner {
      background-color: #d32f2f;
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }

    .verification-banner h3 {
      margin-top: 0;
      font-size: 1.5rem;
    }

    .verification-banner p {
      margin-bottom: 0;
      font-size: 1rem;
    }

    /* Form styling */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }

    .form-group label.required::after {
      content: " *";
      color: #d32f2f;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-col {
      flex: 1;
      min-width: 300px;
    }

    .file-upload-container {
      border: 2px dashed #2196F3;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin-top: 10px;
      background-color: #f0f8ff;
      transition: border-color 0.3s;
    }

    .file-upload-container:hover {
      border-color: #1565c0;
      background-color: #e3f2fd;
    }

    .file-upload-container input[type="file"] {
      display: block;
      margin: 10px auto;
      padding: 10px;
      background-color: white;
      border-radius: 4px;
      border: 1px solid #ddd;
      width: 80%;
    }

    .file-upload-container .file-info {
      font-size: 13px;
      color: #666;
      margin-top: 10px;
      line-height: 1.5;
    }

    .password-match {
      color: green;
      font-size: 14px;
      margin-top: 5px;
    }

    .password-mismatch {
      color: red;
      font-size: 14px;
      margin-top: 5px;
    }

    .form-section {
      background-color: white;
      border-radius: 8px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .form-section h3 {
      color: #d32f2f;
      margin-top: 0;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
    }

    .instructions {
      background-color: #e8f4fd;
      border-left: 4px solid #254a93;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .instructions h4 {
      margin-top: 0;
      color: #254a93;
    }

    .instructions ul {
      margin: 10px 0;
      padding-left: 20px;
    }

    .instructions li {
      margin-bottom: 5px;
    }

    /* Terms & Conditions Styling */
    .terms-container {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }

    .terms-content {
      font-size: 14px;
      line-height: 1.6;
      color: #333;
    }

    .terms-content h4 {
      color: #d32f2f;
      margin-top: 15px;
      margin-bottom: 10px;
    }

    .terms-content ul {
      padding-left: 20px;
      margin: 10px 0;
    }

    .terms-content li {
      margin-bottom: 8px;
    }

    .terms-checkbox {
      display: flex;
      align-items: flex-start;
      margin: 20px 0;
      padding: 15px;
      background-color: #f0f8ff;
      border-radius: 8px;
      border: 1px solid #cce7ff;
    }

    .terms-checkbox input[type="checkbox"] {
      margin-right: 12px;
      margin-top: 4px;
      transform: scale(1.2);
    }

    .terms-checkbox label {
      font-weight: normal;
      cursor: pointer;
      line-height: 1.5;
    }

    .terms-checkbox label a {
      color: #254a93;
      text-decoration: underline;
      font-weight: bold;
    }

    .terms-checkbox label a:hover {
      color: #d32f2f;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #d32f2f;
    }

    .modal-header h3 {
      color: #d32f2f;
      margin: 0;
    }

    .close-modal {
      background: #d32f2f;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-modal:hover {
      background: #b71c1c;
    }

    .modal-body {
      line-height: 1.6;
    }

    .modal-body h4 {
      color: #254a93;
      margin-top: 20px;
      margin-bottom: 10px;
    }

    .modal-body ul {
      padding-left: 20px;
      margin: 10px 0;
    }

    .modal-body li {
      margin-bottom: 8px;
    }

    .read-more-btn {
      background: none;
      border: none;
      color: #254a93;
      text-decoration: underline;
      cursor: pointer;
      font-weight: bold;
      padding: 0;
      margin-left: 5px;
    }

    .read-more-btn:hover {
      color: #d32f2f;
    }

    .btn-disabled {
      background-color: #cccccc !important;
      cursor: not-allowed !important;
    }
    
    .error-field {
      border-color: #d32f2f !important;
      background-color: #fff5f5;
    }
    
    .error-message-small {
      color: #d32f2f;
      font-size: 12px;
      margin-top: 5px;
      display: block;
    }
    
    .id-format-hint {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      display: block;
    }
    
    .id-prefix-badge {
      display: inline-block;
      background-color: #e8f4fd;
      border: 1px solid #254a93;
      border-radius: 4px;
      padding: 2px 6px;
      margin: 0 2px;
      font-size: 11px;
      font-weight: bold;
      color: #254a93;
    }
    
    .prefix-info {
      background-color: #f0f8ff;
      border-left: 4px solid #254a93;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .prefix-info h4 {
      margin-top: 0;
      margin-bottom: 8px;
      color: #254a93;
    }
    
    .prefix-info ul {
      margin: 5px 0;
      padding-left: 20px;
    }
    
    .prefix-info li {
      margin-bottom: 3px;
    }

    /* NEW STYLES FOR CONSOLIDATED UPLOAD SYSTEM */
    .upload-instructions-important {
      background-color: #fff8e1;
      border-left: 4px solid #ff9800;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .upload-instructions-important h4 {
      color: #ff9800;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 16px;
    }
    
    .upload-instructions-important ul {
      padding-left: 20px;
      margin: 10px 0;
    }
    
    .upload-instructions-important li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    
    .document-checklist {
      background-color: #e8f5e9;
      border: 1px solid #4CAF50;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      font-size: 13px;
    }
    
    .document-checklist h5 {
      color: #2e7d32;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 14px;
    }
    
    .document-checklist ol {
      padding-left: 20px;
      margin: 10px 0;
      columns: 2;
      column-gap: 20px;
    }
    
    .document-checklist li {
      margin-bottom: 5px;
      break-inside: avoid;
    }
    
    .upload-requirements {
      background-color: #e3f2fd;
      border: 1px solid #2196F3;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      font-size: 13px;
    }
    
    .upload-requirements h5 {
      color: #1565c0;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 14px;
    }
    
    .consolidated-pdf-section {
      background-color: #f5f5f5;
      border: 2px dashed #757575;
      border-radius: 10px;
      padding: 25px;
      margin: 20px 0;
    }
    
    .consolidated-pdf-section h4 {
      color: #424242;
      margin-top: 0;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .file-size-limit {
      font-size: 12px;
      color: #757575;
      font-style: italic;
      text-align: center;
      margin-top: 10px;
    }
    
    .upload-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      display: block;
      margin: 15px auto;
      transition: background-color 0.3s;
    }
    
    .upload-button:hover {
      background-color: #388e3c;
    }
    
    .upload-button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    .upload-progress {
      margin-top: 15px;
      padding: 10px;
      background-color: #f9f9f9;
      border-radius: 5px;
      border: 1px solid #ddd;
      font-size: 14px;
    }
    
    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #e0e0e0;
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
      transition: width 0.3s;
    }
    
    .upload-status {
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      display: inline-block;
      margin-left: 10px;
    }
    
    .status-uploaded {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    
    .status-pending {
      background-color: #fff8e1;
      color: #ff8f00;
    }
    
    .status-missing {
      background-color: #ffebee;
      color: #d32f2f;
    }
    
    @media (max-width: 768px) {
      .document-checklist ol {
        columns: 1;
      }
    }
    
    /* Date of Enlistment info */
    .date-of-enlistment-info {
      background-color: #f0f8ff;
      border-left: 4px solid #4CAF50;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }

    .date-of-enlistment-info h4 {
      color: #4CAF50;
      margin-top: 0;
      margin-bottom: 10px;
    }

    .required-badge {
      background-color: #ffebee;
      color: #d32f2f;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 5px;
    }

    .optional-badge {
      background-color: #e8f5e9;
      color: #4CAF50;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 5px;
    }
  </style>
</head>
<body>

<header class="header-container">
  <div class="header-logo">
    <img src="images/logo.png" alt="Marshal Core of Nigeria Logo">
  </div>
  <div class="header-rc">
    YA/CLB/10100
  </div>
  <div class="header-title">
    Marshal Core of Nigeria - Existing Officer Verification
  </div>
  <div class="header-subtitle">
    Legacy Officers (MCN, MBT, MBC) - No Payment Required
  </div>
</header>

<!-- OFFICER VERIFICATION SECTION -->
<section class="layout_padding section-container active-section" id="verificationSection">
  <div class="container">
    <div class="verification-banner">
      <h3>üîç Officer Verification Required</h3>
      <p>As an existing officer, verify your identity before proceeding with registration.</p>
    </div>
    
    <div class="form-section">
      <h2>Step 1: Officer Verification</h2>
      
      <div class="prefix-info">
        <h4>üìã Officer ID Format:</h4>
        <ul>
          <li><strong>Format:</strong> <span class="id-prefix-badge">PREFIX</span>/<span class="id-prefix-badge">ALPHANUMERIC</span>/<span class="id-prefix-badge">INTAKE</span></li>
          <li><span class="id-prefix-badge">MCN</span> - Marshal Core of Nigeria (e.g., MCN/001B/031)</li>
          <li><span class="id-prefix-badge">MBT</span> - Marshal Board of Trustees (e.g., MBT/A01/123)</li>
          <li><span class="id-prefix-badge">MBC</span> - Marshal Board Committee (e.g., MBC/1234/001)</li>
        </ul>
        <p><strong>Note:</strong> Alphanumeric can be 3-4 characters (letters/numbers), Intake is 3 digits</p>
      </div>
      
      <div id="statusMessage" class="status-message" style="display: none;"></div>
      <form id="verificationForm" class="contact_form-container">
        <div class="form-row">
          <div class="form-col">
            <label for="officerId" class="required">Officer ID (Format)</label>
            <input type="text" id="officerId" placeholder="MCN/001B/031" required 
                   pattern="^(MCN|MBT|MBC)/[A-Z0-9]{3,4}/\d{3}$"
                   title="Format: PREFIX/ALPHANUMERIC/INTAKE (e.g., MCN/001B/031)" />
            <span id="officerIdError" class="error-message-small"></span>
            <span class="id-format-hint">Format: PREFIX/ALPHANUMERIC/INTAKE (e.g., MCN/001B/031)</span>
          </div>
          <div class="form-col">
            <label for="officerEmail" class="required">Official Email Address</label>
            <input type="email" id="officerEmail" placeholder="Enter your official email" required />
            <span id="officerEmailError" class="error-message-small"></span>
            <span class="id-format-hint">Use a professional email address (Gmail, Yahoo, etc.)</span>
          </div>
        </div>
        <button type="submit" id="verifyBtn">Verify Officer Identity</button>
      </form>
      <p id="verificationMessage"></p>
    </div>
  </div>
</section>

<!-- APPLICATION FORM SECTION -->
<section class="layout_padding section-container" id="applicationFormSection">
  <div class="container">
    <div class="verification-banner" style="background-color: #4CAF50;">
      <h3>‚úÖ Officer Verified Successfully!</h3>
      <p id="verifiedCategoryMessage">Please complete your registration form below. Fields marked with * are required.</p>
    </div>

    <div class="form-section">
      <h2>Step 2: Officer Registration Form</h2>
      <div class="instructions">
        <h4>üìã Instructions:</h4>
        <ul>
          <li>Fill in all required fields marked with *</li>
          <li>Use strong password (minimum 8 characters) - This will be your login password</li>
          <li>Ensure all information is accurate</li>
          <li>Your Officer ID: <strong id="displayOfficerId"></strong></li>
          <li>Category: <strong id="displayCategory"></strong></li>
          <li><strong>IMPORTANT:</strong> You only need to upload 2 files: Passport Photo and Consolidated PDF</li>
        </ul>
      </div>

      <form id="applicationForm">

        <!-- Personal Information Section -->
        <div class="form-section">
          <h3>üìù Personal Information</h3>
          <div class="form-row">
            <div class="form-col">
              <label for="surname" class="required">Surname *</label>
              <input type="text" id="surname" name="surname" placeholder="Enter your surname" required />
              <span id="surnameError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="first_name" class="required">First Name *</label>
              <input type="text" id="first_name" name="first_name" placeholder="Enter your first name" required />
              <span id="firstNameError" class="error-message-small"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <label for="other_name">Other Name (Optional)</label>
              <input type="text" id="other_name" name="other_name" placeholder="Enter your other name" />
            </div>
            <div class="form-col">
              <label for="date_of_birth" class="required">Date of Birth *</label>
              <input type="date" id="date_of_birth" name="date_of_birth" required />
              <span id="dobError" class="error-message-small"></span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <label for="residential_address" class="required">Residential Address *</label>
              <textarea id="residential_address" name="residential_address" rows="3" placeholder="Enter your full residential address" required></textarea>
              <span id="addressError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="id_card_number" class="required">NIN Number *</label>
              <input type="text" id="id_card_number" name="id_card_number" placeholder="Enter your NIN number" required 
                     pattern="^\d{11}$" title="NIN must be 11 digits" />
              <span id="ninError" class="error-message-small"></span>
            </div>
          </div>
          
          <!-- Add Gender field -->
          <div class="form-row">
            <div class="form-col">
              <label for="gender" class="required">Gender *</label>
              <select id="gender" name="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
              <span id="genderError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="marital_status">Marital Status (Optional)</label>
              <select id="marital_status" name="marital_status">
                <option value="">Select Marital Status</option>
                <option value="Single">Single</option>
                <option value="Married">Married</option>
                <option value="Divorced">Divorced</option>
                <option value="Widowed">Widowed</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Date of Enlistment & Promotion Section -->
        <div class="form-section">
          <h3>üéñÔ∏è Service Dates</h3>
          <div class="date-of-enlistment-info">
            <h4>üìÖ Important: Date of Enlistment is REQUIRED</h4>
            <p>This information is required for all existing officers. Please provide accurate dates.</p>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <label for="date_of_enlistment" class="required">Date of Enlistment * <span class="required-badge">REQUIRED</span></label>
              <input type="date" id="date_of_enlistment" name="date_of_enlistment" required />
              <span id="enlistmentError" class="error-message-small"></span>
              <span class="id-format-hint">When you first enlisted as an officer</span>
            </div>
            <div class="form-col">
              <label for="date_of_promotion">Date of Last Promotion <span class="optional-badge">OPTIONAL</span></label>
              <input type="date" id="date_of_promotion" name="date_of_promotion" />
              <span id="promotionError" class="error-message-small"></span>
              <span class="id-format-hint">Date of your last promotion (if applicable)</span>
            </div>
          </div>
          
          <!-- Add optional fields for place of birth, nationality, etc. -->
          <div class="form-row">
            <div class="form-col">
              <label for="place_of_birth">Place of Birth (Optional)</label>
              <input type="text" id="place_of_birth" name="place_of_birth" placeholder="Enter your place of birth" />
            </div>
            <div class="form-col">
              <label for="nationality">Nationality</label>
              <input type="text" id="nationality" name="nationality" placeholder="e.g., Nigerian" value="Nigerian" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <label for="state_of_residence">State of Residence (Optional)</label>
              <input type="text" id="state_of_residence" name="state_of_residence" placeholder="e.g., Lagos State" />
            </div>
            <div class="form-col">
              <label for="local_government_residence">Local Government of Residence (Optional)</label>
              <input type="text" id="local_government_residence" name="local_government_residence" placeholder="e.g., Ikeja" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <label for="country_of_residence">Country of Residence</label>
              <input type="text" id="country_of_residence" name="country_of_residence" placeholder="e.g., Nigeria" value="Nigeria" />
            </div>
            <div class="form-col">
              <label for="state_of_origin">State of Origin (Optional)</label>
              <input type="text" id="state_of_origin" name="state_of_origin" placeholder="e.g., Edo State" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <label for="local_government_origin">Local Government of Origin (Optional)</label>
              <input type="text" id="local_government_origin" name="local_government_origin" placeholder="e.g., Oredo" />
            </div>
            <div class="form-col">
              <label for="religion">Religion (Optional)</label>
              <select id="religion" name="religion">
                <option value="">Select Religion</option>
                <option value="Christianity">Christianity</option>
                <option value="Islam">Islam</option>
                <option value="Traditional">Traditional</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Contact Information Section -->
        <div class="form-section">
          <h3>üìû Contact Information</h3>
          <div class="form-row">
            <div class="form-col">
              <label for="email_address">Email Address</label>
              <input type="email" id="email_address" name="email_address" placeholder="Enter your email address" readonly />
            </div>
            <div class="form-col">
              <label for="mobile_number" class="required">Phone Number *</label>
              <input type="tel" id="mobile_number" name="mobile_number" placeholder="Enter your phone number" required 
                     pattern="^(\+234|0)\d{10}$" title="Format: +2348012345678 or 08012345678" />
              <span id="phoneError" class="error-message-small"></span>
              <span class="id-format-hint">Format: +2348012345678 or 08012345678</span>
            </div>
          </div>
        </div>

        <!-- Service Information Section -->
        <div class="form-section">
          <h3>üéñÔ∏è Service Information</h3>
          <div class="form-row">
            <div class="form-col">
              <label for="rank" class="required">Rank *</label>
              <select id="rank" name="rank" required>
                <option value="">Select Rank</option>
                <option value="Assistant Director General">Assistant Director General</option>
                <option value="Director">Director</option>
                <option value="Deputy Director">Deputy Director</option>
                <option value="Assistant Director">Assistant Director</option>
                <option value="Superintendent of Marshal">Superintendent of Marshal</option>
                <option value="Deputy Superintendent">Deputy Superintendent</option>
                <option value="Assistant Marshal Officer I">Assistant Marshal Officer I</option>
                <option value="Assistant Marshal Officer II">Assistant Marshal Officer II</option>
                <option value="Senior Marshal Officer">Senior Marshal Officer</option>
                <option value="Marshal Staff">Marshal Staff</option>
                <option value="Marshal Sergeant">Marshal Sergeant</option>
                <option value="Marshal Corporal">Marshal Corporal</option>
                <option value="Marshal Lance Corporal">Marshal Lance Corporal</option>
                <option value="Marshal Private">Marshal Private</option>
              </select>
              <span id="rankError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="appointment">Appointment (If Applicable)</label>
              <input type="text} id="appointment" name="appointment" placeholder="Enter your appointment" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <label for="years_of_service">Years of Service (Optional)</label>
              <input type="number" id="years_of_service" name="years_of_service" placeholder="e.g., 5" min="0" max="50" />
            </div>
            <div class="form-col">
              <label for="additional_skills">Additional Skills (Optional)</label>
              <textarea id="additional_skills" name="additional_skills" rows="2" placeholder="e.g., Computer skills, Leadership, etc."></textarea>
            </div>
          </div>
        </div>

        <!-- Bank Information Section -->
        <div class="form-section">
          <h3>üè¶ Bank Information (Optional)</h3>
          <div class="instructions">
            <h4>Note:</h4>
            <p>Bank information is optional but recommended for payment processing if applicable.</p>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label for="bank_name">Bank Name (Optional)</label>
              <input type="text" id="bank_name" name="bank_name" placeholder="e.g., First Bank, Zenith Bank" />
            </div>
            <div class="form-col">
              <label for="account_number">Account Number (Optional)</label>
              <input type="text" id="account_number" name="account_number" placeholder="10-digit account number" pattern="\d{10}" />
            </div>
          </div>
        </div>

        <!-- NEW: Document Upload Section (2 files only) -->
        <div class="form-section">
          <h3>üìé Document Upload (2 Files Only)</h3>
          
          <div class="upload-instructions-important">
            <h4>üìã IMPORTANT UPLOAD INSTRUCTIONS:</h4>
            <p><strong>You only need to upload 2 files:</strong></p>
            <ul>
              <li><strong>1. Passport Photo</strong> - Separate JPG/PNG file</li>
              <li><strong>2. Consolidated PDF</strong> - Single PDF containing ALL other documents listed below</li>
            </ul>
          </div>
          
          <!-- Document Checklist -->
          <div class="document-checklist">
            <h5>üìÑ Consolidated PDF MUST Include These 10 Documents:</h5>
            <ol>
              <li>NIN slip</li>
              <li>All school results</li>
              <li>Birth certificates</li>
              <li>Back and front ID card</li>
              <li>All Gmail forms</li>
              <li>All marshal certificates</li>
              <li>Bio data enrollment/ appointment letter</li>
              <li>Promotion letter</li>
              <li>Application form</li>
              <li>Both affidavits of non membership of cult groups</li>
            </ol>
          </div>
          
          <div class="upload-requirements">
            <h5>üìã File Requirements:</h5>
            <ul>
              <li><strong>Passport Photo:</strong> JPG or PNG format, max 2MB</li>
              <li><strong>Consolidated PDF:</strong> Single PDF file, max 10MB</li>
              <li><strong>All documents must be clear and legible</strong></li>
              <li><strong>Scan all documents into ONE PDF file</strong> before uploading</li>
            </ul>
          </div>
          
          <!-- Passport Photo Upload -->
          <div class="form-row">
            <div class="form-col">
              <label for="passport_photo" class="required">Passport Photo <span class="required-badge">REQUIRED</span></label>
              <div class="file-upload-container">
                <input type="file" id="passport_photo" name="passport_photo" accept=".jpg,.jpeg,.png" required />
                <div class="file-info">JPG or PNG format only. Max size: 2MB</div>
              </div>
              <span id="passportError" class="error-message-small"></span>
            </div>
            
            <div class="form-col">
              <label for="consolidated_pdf" class="required">Consolidated PDF <span class="required-badge">REQUIRED</span></label>
              <div class="file-upload-container">
                <input type="file" id="consolidated_pdf" name="consolidated_pdf" accept=".pdf" required />
                <div class="file-info">Single PDF containing all 10 listed documents. Max size: 10MB</div>
              </div>
              <span id="pdfError" class="error-message-small"></span>
            </div>
          </div>
          
          <!-- Upload Progress -->
          <div class="upload-progress" style="display: none;" id="uploadProgress">
            <div id="uploadStatusText">Uploading files...</div>
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
          </div>
          
          <!-- Upload Status -->
          <div class="form-row" style="margin-top: 20px;">
            <div class="form-col">
              <div style="text-align: center;">
                <span>Passport Status:</span>
                <span id="passportStatus" class="upload-status status-missing">Not Uploaded</span>
              </div>
            </div>
            <div class="form-col">
              <div style="text-align: center;">
                <span>PDF Status:</span>
                <span id="pdfStatus" class="upload-status status-missing">Not Uploaded</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Account Security Section -->
        <div class="form-section">
          <h3>üîê Account Security</h3>
          <div class="instructions">
            <h4>Important:</h4>
            <p>This password will be used to login to your <strong>Existing Officer Dashboard</strong> using your Officer ID only.</p>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label for="password" class="required">Create Password *</label>
              <input type="password" id="password" name="password" placeholder="Create a strong password (min. 8 characters)" required 
                     minlength="8" />
              <span id="passwordError" class="error-message-small"></span>
              <span class="id-format-hint">This password will be used for dashboard login</span>
            </div>
            <div class="form-col">
              <label for="confirm_password" class="required">Re-enter Password *</label>
              <input type="password" id="confirm_password" name="confirm_password" placeholder="Re-enter your password" required />
              <div id="passwordMatchMessage" class="password-mismatch"></div>
            </div>
          </div>
        </div>

        <!-- TERMS & CONDITIONS SECTION -->
        <div class="form-section">
          <h3>üìú Terms & Conditions Agreement</h3>
          
          <div class="terms-container">
            <div class="terms-content" id="termsContent">
              <h4>Marshal Core of Nigeria - Existing Officer Registration Terms</h4>
              <p><strong>Effective Date:</strong> March 19, 2025</p>
              
              <h4>1. Existing Officer Registration</h4>
              <p>By registering as an existing officer, you confirm that you were previously registered in the Marshal Core of Nigeria system.</p>
              
              <h4>2. Dashboard Access</h4>
              <ul>
                <li>You will access your dashboard using Officer ID and the password created during registration</li>
                <li>Email login is not available for existing officers</li>
                <li>Keep your password secure and do not share it</li>
              </ul>
              
              <h4>3. Document Requirements</h4>
              <ul>
                <li><strong>Passport Photo</strong> - Separate file (JPG/PNG)</li>
                <li><strong>Consolidated PDF</strong> - Single PDF containing all required documents</li>
                <li>All documents must be clear and legible</li>
              </ul>
              
              <h4>4. PDF Generation & Email Delivery</h4>
              <p>Upon successful registration, two PDFs will be generated and sent to your email:</p>
              <ul>
                <li>Terms & Conditions PDF</li>
                <li>Existing Officer Registration Form PDF</li>
              </ul>
              
              <p><em>By checking the box below, you acknowledge that you have read, understood, and agree to be bound by these Terms & Conditions.</em></p>
            </div>
          </div>
          
          <div class="terms-checkbox">
            <input type="checkbox" id="agreeTerms" name="agreeTerms" required />
            <label for="agreeTerms">
              I have read and agree to the Terms & Conditions of Marshal Core of Nigeria Existing Officer Registration. 
              I understand that I will login to the dashboard using my Officer ID only.
              <button type="button" class="read-more-btn" onclick="openFullTerms()">Read Full Terms</button>
            </label>
          </div>
        </div>

        <!-- Hidden fields -->
        <input type="hidden" id="verified_officer_id" name="verified_officer_id" />
        <input type="hidden" id="verified_officer_email" name="verified_officer_email" />
        <input type="hidden" id="service_number" name="service_number" />

        <!-- Submit Button -->
        <div class="form-section" style="text-align: center; background-color: #f9f9f9;">
          <button type="submit" id="submitBtn" style="width: auto; padding: 15px 50px;">
            Submit Officer Registration
          </button>
          <p style="margin-top: 15px; color: #666; font-size: 14px;">
            By submitting, you confirm that all information provided is accurate and complete.
            You will receive PDFs via email and can login to your dashboard using your Officer ID.
          </p>
        </div>

      </form>
    </div>
  </div>
</section>

<!-- Terms Modal -->
<div id="termsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>üìú Marshal Core of Nigeria - Full Terms & Conditions</h3>
      <button class="close-modal" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <h4>Complete Terms & Conditions</h4>
      <p><strong>1. Introduction</strong><br>
      Welcome to Marshal Core of Nigeria. These Terms & Conditions govern your registration as an existing officer in our system.</p>
      
      <p><strong>2. Officer Verification</strong><br>
      You must provide accurate officer ID and email for verification. False information may result in account termination.</p>
      
      <p><strong>3. Document Upload</strong><br>
      You agree to upload only clear, legible documents. The consolidated PDF must contain all listed documents.</p>
      
      <p><strong>4. Account Security</strong><br>
      You are responsible for maintaining the confidentiality of your password and officer ID.</p>
      
      <p><strong>5. Data Privacy</strong><br>
      Your personal information will be protected according to our privacy policy and Nigerian data protection laws.</p>
      
      <p><strong>6. System Updates</strong><br>
      Marshal Core of Nigeria reserves the right to update these terms and system features as needed.</p>
      
      <p><strong>7. Contact Information</strong><br>
      For support, contact: support@marshalcoreofnigeria.ng</p>
      
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="closeModal()" style="background: #d32f2f; color: white; border: none; padding: 10px 30px; border-radius: 5px; cursor: pointer;">
          Close and Return to Form
        </button>
      </div>
    </div>
  </div>
</div>

<footer class="footer_section">
  <div class="container">
    <p>&copy; 2025 Marshal Core of Nigeria. <br>All rights reserved.</p>
    <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
      For support: support@marshalcoreofnigeria.ng
    </p>
  </div>
</footer>

<div class="page-loader" id="pageLoader">Loading...</div>

<script>
window.onload = () => {
  const verificationForm = document.getElementById("verificationForm");
  const applicationForm = document.getElementById("applicationForm");
  const pageLoader = document.getElementById("pageLoader");
  const statusMessage = document.getElementById("statusMessage");
  const verificationMessage = document.getElementById("verificationMessage");
  const verifyBtn = document.getElementById("verifyBtn");
  const submitBtn = document.getElementById("submitBtn");
  const agreeTermsCheckbox = document.getElementById("agreeTerms");
  const passwordMatchMessage = document.getElementById("passwordMatchMessage");
  const displayOfficerId = document.getElementById("displayOfficerId");
  const displayCategory = document.getElementById("displayCategory");
  const verifiedCategoryMessage = document.getElementById("verifiedCategoryMessage");
  const officerIdInput = document.getElementById("officerId");
  const passportStatus = document.getElementById("passportStatus");
  const pdfStatus = document.getElementById("pdfStatus");
  const uploadProgress = document.getElementById("uploadProgress");
  const progressFill = document.getElementById("progressFill");
  const uploadStatusText = document.getElementById("uploadStatusText");

  // Your backend URL
  const API_BASE_URL = 'https://backend-mcn-ltd.onrender.com';
  
  // Endpoints for existing officers
  const OFFICER_VERIFY_ENDPOINT = `${API_BASE_URL}/api/existing-officers/verify`;
  const OFFICER_REGISTER_ENDPOINT = `${API_BASE_URL}/api/existing-officers/register`;
  const OFFICER_UPLOAD_ENDPOINT = `${API_BASE_URL}/api/existing-officers/upload-document`;

  let verifiedOfficerId = "";
  let verifiedOfficerEmail = "";
  let officerCategory = "";
  let uploadedFiles = {
    passport: false,
    consolidated_pdf: false
  };

  // Modal functions
  function openFullTerms() {
    document.getElementById('termsModal').style.display = 'block';
  }

  function closeModal() {
    document.getElementById('termsModal').style.display = 'none';
  }

  // Close modal when clicking outside
  window.onclick = function(event) {
    const modal = document.getElementById('termsModal');
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }

  // Utility functions
  function showLoader() {
    pageLoader.style.display = "flex";
  }

  function hideLoader() {
    pageLoader.style.display = "none";
  }

  function showSection(sectionId) {
    document.querySelectorAll('.section-container').forEach(section => {
      section.classList.remove('active-section');
    });
    document.getElementById(sectionId).classList.add('active-section');
    window.scrollTo(0, 0);
  }

  function showError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const errorSpan = document.getElementById(`${fieldId}Error`);
    
    if (field) {
      field.classList.add('error-field');
    }
    
    if (errorSpan) {
      errorSpan.textContent = message;
      errorSpan.style.display = 'block';
    }
  }

  function clearError(fieldId) {
    const field = document.getElementById(fieldId);
    const errorSpan = document.getElementById(`${fieldId}Error`);
    
    if (field) {
      field.classList.remove('error-field');
    }
    
    if (errorSpan) {
      errorSpan.textContent = '';
      errorSpan.style.display = 'none';
    }
  }

  function clearAllErrors() {
    const errorSpans = document.querySelectorAll('.error-message-small');
    errorSpans.forEach(span => {
      span.textContent = '';
      span.style.display = 'none';
    });
    
    const errorFields = document.querySelectorAll('.error-field');
    errorFields.forEach(field => {
      field.classList.remove('error-field');
    });
  }

  function showVerificationMessage(message, isError = false) {
    verificationMessage.textContent = message;
    verificationMessage.style.color = isError ? 'red' : 'green';
    verificationMessage.className = isError ? 'error-message' : 'success-message';
  }

  // Password match validation
  function validatePasswordMatch() {
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm_password").value;
    
    if (password === "" && confirmPassword === "") {
      passwordMatchMessage.textContent = "";
      passwordMatchMessage.className = "";
      return false;
    }
    
    if (password === confirmPassword) {
      passwordMatchMessage.textContent = "‚úì Passwords match";
      passwordMatchMessage.className = "password-match";
      return true;
    } else {
      passwordMatchMessage.textContent = "‚úó Passwords do not match";
      passwordMatchMessage.className = "password-mismatch";
      return false;
    }
  }

  // Add event listeners for password validation
  document.getElementById("password").addEventListener('input', validatePasswordMatch);
  document.getElementById("confirm_password").addEventListener('input', validatePasswordMatch);

  // Enhanced fetch with better error handling
  async function makeRequest(url, options = {}) {
    const defaultOptions = {
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
      },
      credentials: 'include',
    };

    const mergedOptions = {
      ...defaultOptions,
      ...options,
      headers: {
        ...defaultOptions.headers,
        ...options.headers,
      },
    };

    try {
      const response = await fetch(url, mergedOptions);
      
      // Parse response
      let data;
      const contentType = response.headers.get('content-type');
      if (contentType && contentType.includes('application/json')) {
        data = await response.json();
      } else {
        const text = await response.text();
        data = { text: text, status: response.status };
      }

      return {
        ok: response.ok,
        status: response.status,
        data: data
      };
      
    } catch (error) {
      console.error('Request failed:', error);
      return {
        ok: false,
        status: 0,
        data: { detail: 'Network error. Please check your internet connection.' }
      };
    }
  }

  // Validate email format
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Validate required fields
  function validateForm(formId) {
    const form = document.getElementById(formId);
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;

    requiredFields.forEach(field => {
      if (!field.value.trim()) {
        showError(field.id, 'This field is required');
        isValid = false;
      } else {
        clearError(field.id);
        
        // Additional validation for specific fields
        if (field.type === 'email' && !isValidEmail(field.value)) {
          showError(field.id, 'Please enter a valid email address');
          isValid = false;
        }
        
        if (field.id === 'password' && field.value.length < 8) {
          showError(field.id, 'Password must be at least 8 characters long');
          isValid = false;
        }
        
        // Validate officer ID format
        if (field.id === 'officerId') {
          const isValidId = validateOfficerIdFormat(field.value);
          if (!isValidId.isValid) {
            showError(field.id, isValidId.message);
            isValid = false;
          }
        }
        
        // Validate date of enlistment is not in future
        if (field.id === 'date_of_enlistment') {
          const enlistmentDate = new Date(field.value);
          const today = new Date();
          if (enlistmentDate > today) {
            showError(field.id, 'Date of enlistment cannot be in the future');
            isValid = false;
          }
        }
        
        // Validate promotion date is after enlistment if both provided
        const enlistmentDate = document.getElementById('date_of_enlistment').value;
        const promotionDate = document.getElementById('date_of_promotion').value;
        if (enlistmentDate && promotionDate) {
          const enlistment = new Date(enlistmentDate);
          const promotion = new Date(promotionDate);
          if (promotion < enlistment) {
            showError('date_of_promotion', 'Promotion date must be after enlistment date');
            isValid = false;
          }
          if (promotion > new Date()) {
            showError('date_of_promotion', 'Promotion date cannot be in the future');
            isValid = false;
          }
        }
      }
    });

    return isValid;
  }

  // Validate officer ID format
  function validateOfficerIdFormat(id) {
    if (!id || id.trim() === '') {
      return {
        isValid: false,
        message: 'Officer ID is required'
      };
    }
    
    id = id.trim().toUpperCase();
    
    const pattern = /^(MCN|MBT|MBC)\/[A-Z0-9]{3,4}\/\d{3}$/;
    
    if (!pattern.test(id)) {
      return {
        isValid: false,
        message: 'Invalid format. Use: PREFIX/ALPHANUMERIC/INTAKE (e.g., MCN/001B/031)'
      };
    }
    
    const parts = id.split('/');
    const prefix = parts[0];
    const alphanumeric = parts[1];
    const intake = parts[2];
    
    if (!/^[A-Z0-9]{3,4}$/.test(alphanumeric)) {
      return {
        isValid: false,
        message: 'Alphanumeric part must be 3-4 characters (letters/numbers)'
      };
    }
    
    const intakeNum = parseInt(intake);
    if (intakeNum < 1 || intakeNum > 999) {
      return {
        isValid: false,
        message: 'Intake must be between 001 and 999'
      };
    }
    
    return { 
      isValid: true, 
      message: 'Valid ID format',
      formattedId: id,
      prefix: prefix,
      alphanumeric: alphanumeric,
      intake: intake
    };
  }

  // Auto-format officer ID input
  function autoFormatOfficerId(input) {
    let value = input.value.toUpperCase();
    let cursorPos = input.selectionStart;
    
    value = value.replace(/[^A-Z0-9\/]/g, '');
    
    if (value.length === 3 && ['MCN', 'MBT', 'MBC'].includes(value)) {
      value = value + '/';
      cursorPos = 4;
    }
    
    if (value.includes('/') && value.split('/').length === 2) {
      const parts = value.split('/');
      const alphanumeric = parts[1];
      if (alphanumeric.length >= 3 && alphanumeric.length <= 4) {
        if (!value.endsWith('/')) {
          value = value + '/';
          cursorPos = value.length;
        }
      }
    }
    
    input.value = value;
    
    setTimeout(() => {
      input.setSelectionRange(cursorPos, cursorPos);
    }, 0);
    
    clearError('officerId');
    updateFormatHint(value);
  }

  // Update format hint function
  function updateFormatHint(value) {
    const hintElement = document.querySelector('.id-format-hint');
    if (!hintElement) return;
    
    value = value.toUpperCase();
    
    if (value.length === 0) {
      hintElement.textContent = 'Format: PREFIX/ALPHANUMERIC/INTAKE (e.g., MCN/001B/031)';
      hintElement.style.color = '#666';
    } else if (value.length >= 1 && value.length <= 3) {
      const currentText = value.substring(0, 3);
      if (['M', 'MC', 'MCN', 'MB', 'MBT', 'MBC'].includes(currentText)) {
        hintElement.textContent = `Continue with ${currentText}/alphanumeric/intake format`;
        hintElement.style.color = '#4CAF50';
      } else {
        hintElement.textContent = 'Must start with MCN, MBT, or MBC';
        hintElement.style.color = '#d32f2f';
      }
    } else if (value.length > 3) {
      if (value.includes('/')) {
        const parts = value.split('/');
        if (parts.length === 1) {
          hintElement.textContent = 'Add /alphanumeric/intake (e.g., /001B/031)';
          hintElement.style.color = '#4CAF50';
        } else if (parts.length === 2) {
          const alphanumeric = parts[1];
          if (alphanumeric.length < 3) {
            hintElement.textContent = `Alphanumeric part needs ${3 - alphanumeric.length} more characters`;
            hintElement.style.color = '#FF9800';
          } else if (alphanumeric.length >= 3 && alphanumeric.length <= 4) {
            hintElement.textContent = 'Add /intake (e.g., /031)';
            hintElement.style.color = '#4CAF50';
          } else {
            hintElement.textContent = 'Alphanumeric part too long (max 4 characters)';
            hintElement.style.color = '#d32f2f';
          }
        } else if (parts.length >= 3) {
          const intake = parts[2];
          if (intake.length < 3) {
            hintElement.textContent = `Intake needs ${3 - intake.length} more digits`;
            hintElement.style.color = '#FF9800';
          } else if (intake.length === 3) {
            hintElement.textContent = 'Format looks good!';
            hintElement.style.color = '#4CAF50';
          } else {
            hintElement.textContent = 'Intake should be exactly 3 digits';
            hintElement.style.color = '#d32f2f';
          }
        }
      } else {
        hintElement.textContent = 'Add slash after prefix (e.g., MCN/)';
        hintElement.style.color = '#FF9800';
      }
    }
  }

  // NEW: Handle file uploads with progress
  async function uploadDocument(file, documentType) {
    const formData = new FormData();
    formData.append('officer_id', verifiedOfficerId);
    formData.append('document_type', documentType);
    formData.append('file', file);
    
    // Show progress bar
    uploadProgress.style.display = 'block';
    uploadStatusText.textContent = `Uploading ${documentType.replace('_', ' ')}...`;
    progressFill.style.width = '0%';
    
    try {
      const response = await fetch(OFFICER_UPLOAD_ENDPOINT, {
        method: 'POST',
        body: formData,
        credentials: 'include'
      });
      
      // Update progress
      progressFill.style.width = '100%';
      
      if (response.ok) {
        const data = await response.json();
        
        // Update status
        if (documentType === 'passport') {
          passportStatus.textContent = '‚úì Uploaded';
          passportStatus.className = 'upload-status status-uploaded';
          uploadedFiles.passport = true;
        } else if (documentType === 'consolidated_pdf') {
          pdfStatus.textContent = '‚úì Uploaded';
          pdfStatus.className = 'upload-status status-uploaded';
          uploadedFiles.consolidated_pdf = true;
        }
        
        uploadStatusText.textContent = `${documentType.replace('_', ' ')} uploaded successfully!`;
        setTimeout(() => {
          uploadProgress.style.display = 'none';
        }, 1000);
        
        return data;
      } else {
        const errorData = await response.json();
        throw new Error(errorData.detail || 'Upload failed');
      }
    } catch (error) {
      console.error('Upload error:', error);
      uploadStatusText.textContent = `Failed to upload ${documentType.replace('_', ' ')}`;
      uploadStatusText.style.color = '#d32f2f';
      throw error;
    }
  }

  // Validate file size and type
  function validateFile(file, fieldId, documentType) {
    let maxSize, allowedTypes;
    
    if (documentType === 'passport') {
      maxSize = 2 * 1024 * 1024; // 2MB
      allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
    } else if (documentType === 'consolidated_pdf') {
      maxSize = 10 * 1024 * 1024; // 10MB
      allowedTypes = ['application/pdf'];
    }
    
    if (file.size > maxSize) {
      showError(fieldId, `File size exceeds ${maxSize/(1024*1024)}MB limit`);
      return false;
    }
    
    if (!allowedTypes.includes(file.type)) {
      if (documentType === 'passport') {
        showError(fieldId, 'Invalid file type. Allowed: JPG, JPEG, PNG');
      } else {
        showError(fieldId, 'Invalid file type. Only PDF files allowed');
      }
      return false;
    }
    
    clearError(fieldId);
    return true;
  }

  // Handle officer verification
  verificationForm.addEventListener("submit", async function(e) {
    e.preventDefault();
    
    clearAllErrors();
    showVerificationMessage("");
    
    if (!validateForm('verificationForm')) {
      return;
    }

    const officerId = document.getElementById("officerId").value.trim().toUpperCase();
    const officerEmail = document.getElementById("officerEmail").value.trim().toLowerCase();

    const validation = validateOfficerIdFormat(officerId);
    if (!validation.isValid) {
      showError('officerId', validation.message);
      return;
    }
    
    const formattedOfficerId = validation.formattedId || officerId;

    try {
      verifyBtn.disabled = true;
      verifyBtn.innerHTML = 'Verifying...';
      showLoader();
      
      const response = await makeRequest(OFFICER_VERIFY_ENDPOINT, {
        method: "POST",
        body: JSON.stringify({ 
          officer_id: formattedOfficerId, 
          email: officerEmail 
        })
      });

      if (response.ok) {
        verifiedOfficerId = formattedOfficerId;
        verifiedOfficerEmail = officerEmail;
        officerCategory = response.data.category || '';
        
        // Store in hidden fields
        document.getElementById("verified_officer_id").value = formattedOfficerId;
        document.getElementById("verified_officer_email").value = officerEmail;
        document.getElementById("service_number").value = formattedOfficerId;
        
        // Display officer ID and category in the form
        if (displayOfficerId) {
          displayOfficerId.textContent = formattedOfficerId;
        }
        if (displayCategory) {
          displayCategory.textContent = officerCategory || 'N/A';
        }
        
        // Update category message
        if (verifiedCategoryMessage && officerCategory) {
          verifiedCategoryMessage.innerHTML = `‚úÖ <strong>${officerCategory}</strong> Officer Verified Successfully!<br>Please complete your registration form below. Fields marked with * are required.`;
        }
        
        // Pre-fill email in form
        const emailField = document.getElementById("email_address");
        if (emailField) {
          emailField.value = officerEmail;
        }
        
        // Pre-fill officer ID in hidden fields
        document.getElementById('service_number').value = formattedOfficerId;
        
        showVerificationMessage(`‚úÖ ${officerCategory || 'Officer'} verified successfully! Loading registration form...`, false);
        
        // Show registration form after delay
        setTimeout(() => {
          showSection("applicationFormSection");
          showVerificationMessage(""); // Clear message
        }, 1500);
        
      } else {
        let errorMessage = "‚ùå Officer verification failed. ";
        
        if (response.status === 409) {
          errorMessage += "Officer already registered in the system.";
        } else if (response.status === 404) {
          errorMessage += "Officer credentials not found in legacy system.";
        } else if (response.status === 400) {
          if (response.data && response.data.detail) {
            errorMessage += response.data.detail;
          } else {
            errorMessage += "Invalid input format.";
          }
        } else if (response.data && response.data.detail) {
          errorMessage += response.data.detail;
        } else {
          errorMessage += "Please check your credentials and try again.";
        }
        
        showVerificationMessage(errorMessage, true);
      }
      
    } catch (error) {
      console.error("Officer verification error:", error);
      showVerificationMessage("‚ùå Network error. Please check your connection and try again.", true);
      
    } finally {
      verifyBtn.disabled = false;
      verifyBtn.innerHTML = 'Verify Officer Identity';
      hideLoader();
    }
  });

  // Handle officer registration
  applicationForm.addEventListener("submit", async function(e) {
    e.preventDefault();
    console.log("‚úÖ Submit button clicked! Starting registration process...");
    
    clearAllErrors();
    
    // 1. Validate Terms & Conditions
    if (!agreeTermsCheckbox.checked) {
      alert("‚ùå You must agree to the Terms & Conditions to proceed.");
      agreeTermsCheckbox.focus();
      return;
    }

    // 2. Validate passwords match
    if (!validatePasswordMatch()) {
      alert("‚ùå Passwords do not match. Please check and try again.");
      return;
    }

    // 3. Check if officer was verified
    if (!verifiedOfficerId || !verifiedOfficerEmail) {
      alert("‚ùå Please complete officer verification first.");
      showSection("verificationSection");
      return;
    }

    console.log("‚úÖ Basic validations passed");
    
    // 4. Validate all required form fields
    if (!validateForm('applicationForm')) {
      console.log("‚ùå Form validation failed");
      return;
    }
    
    console.log("‚úÖ Form validation passed");

    // 5. Validate required documents
    const passportFile = document.getElementById('passport_photo').files[0];
    const pdfFile = document.getElementById('consolidated_pdf').files[0];
    
    if (!passportFile) {
      showError('passport_photo', 'Passport photo is required');
      return;
    }
    
    if (!pdfFile) {
      showError('consolidated_pdf', 'Consolidated PDF is required');
      return;
    }
    
    // Validate file sizes and types
    if (!validateFile(passportFile, 'passport_photo', 'passport')) return;
    if (!validateFile(pdfFile, 'consolidated_pdf', 'consolidated_pdf')) return;
    
    console.log("‚úÖ Document validation passed");

    // 6. Collect form data
    const formData = {
      officer_id: verifiedOfficerId,
      email: verifiedOfficerEmail,
      phone: document.getElementById("mobile_number").value.replace(/\s/g, ''),
      password: document.getElementById("password").value,
      // NEW FIELDS
      date_of_enlistment: document.getElementById("date_of_enlistment").value,
      date_of_promotion: document.getElementById("date_of_promotion").value || null,
      // Personal Information
      full_name: `${document.getElementById("surname").value.trim()} ${document.getElementById("first_name").value.trim()}`,
      nin_number: document.getElementById("id_card_number").value,
      gender: document.getElementById("gender").value,
      date_of_birth: document.getElementById("date_of_birth").value,
      place_of_birth: document.getElementById("place_of_birth").value || null,
      nationality: "Nigerian",
      marital_status: document.getElementById("marital_status").value || null,
      residential_address: document.getElementById("residential_address").value.trim(),
      state_of_residence: document.getElementById("state_of_residence").value || null,
      local_government_residence: document.getElementById("local_government_residence").value || null,
      country_of_residence: "Nigeria",
      state_of_origin: document.getElementById("state_of_origin").value || null,
      local_government_origin: document.getElementById("local_government_origin").value || null,
      rank: document.getElementById("rank").value,
      position: document.getElementById("appointment").value.trim() || null,
      years_of_service: document.getElementById("years_of_service").value || null,
      service_number: verifiedOfficerId,
      religion: document.getElementById("religion").value || null,
      additional_skills: document.getElementById("additional_skills").value || null,
      bank_name: document.getElementById("bank_name").value || null,
      account_number: document.getElementById("account_number").value || null
    };

    console.log("üì§ Sending registration data:", JSON.stringify(formData, null, 2));

    // 7. Disable submit button and show loader
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Submitting Registration...';
    submitBtn.classList.add('btn-disabled');
    showLoader();

    try {
      console.log("üì° Step 1: Registering officer...");
      
      // Send registration request
      const response = await fetch(OFFICER_REGISTER_ENDPOINT, {
        method: "POST",
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
        },
        body: JSON.stringify(formData),
        credentials: 'include'
      });

      console.log("üì• Registration response status:", response.status);
      
      let responseData;
      try {
        responseData = await response.json();
        console.log("üì• Registration response data:", responseData);
      } catch (jsonError) {
        console.log("‚ö†Ô∏è Could not parse JSON response");
        responseData = { detail: 'Invalid server response' };
      }

      if (!response.ok) {
        let errorMessage = "‚ùå Registration failed. ";
        
        if (response.status === 409) {
          errorMessage += "Officer already registered.";
        } else if (response.status === 422) {
          if (responseData && responseData.detail) {
            if (Array.isArray(responseData.detail)) {
              const errors = responseData.detail.map(err => {
                const field = err.loc && err.loc[1] ? err.loc[1] : 'field';
                return `${field}: ${err.msg}`;
              }).join(', ');
              errorMessage += `Validation errors: ${errors}`;
            } else {
              errorMessage += responseData.detail;
            }
          } else {
            errorMessage += "Please check your information.";
          }
        } else if (responseData && responseData.detail) {
          errorMessage += responseData.detail;
        } else {
          errorMessage += "Please try again.";
        }
        
        alert(errorMessage);
        return;
      }

      console.log("‚úÖ Step 1: Officer registered successfully");
      console.log("üì° Step 2: Uploading documents...");
      
      // 8. Upload documents
      try {
        // Upload passport photo
        await uploadDocument(passportFile, 'passport');
        
        // Upload consolidated PDF
        await uploadDocument(pdfFile, 'consolidated_pdf');
        
        console.log("‚úÖ Step 2: All documents uploaded");
      } catch (uploadError) {
        console.warn("‚ö†Ô∏è Some documents failed to upload:", uploadError);
        alert("‚ö†Ô∏è Registration successful but document upload failed. You can upload documents later from your dashboard.");
      }

      // 9. Success!
      const regId = responseData.registration_id || verifiedOfficerId;
      alert(`üéâ Registration Successful!\n\nOfficer ID: ${verifiedOfficerId}\nRegistration ID: ${regId}\n\nPDF documents will be sent to your email. You can now login to the dashboard.`);
      
      // 10. Reset and go back to verification
      verificationForm.reset();
      applicationForm.reset();
      verifiedOfficerId = "";
      verifiedOfficerEmail = "";
      officerCategory = "";
      uploadedFiles = { passport: false, consolidated_pdf: false };
      passwordMatchMessage.textContent = "";
      agreeTermsCheckbox.checked = false;
      passportStatus.textContent = 'Not Uploaded';
      passportStatus.className = 'upload-status status-missing';
      pdfStatus.textContent = 'Not Uploaded';
      pdfStatus.className = 'upload-status status-missing';
      if (displayOfficerId) displayOfficerId.textContent = "";
      if (displayCategory) displayCategory.textContent = "";
      showSection("verificationSection");
      
    } catch (error) {
      console.error("‚ùå Registration error:", error);
      alert(`‚ùå Error: ${error.message || 'Network error'}`);
      
    } finally {
      // Re-enable submit button
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Submit Officer Registration';
      submitBtn.classList.remove('btn-disabled');
      hideLoader();
    }
  });

  // Add input event listeners to clear errors when user types
  const inputs = document.querySelectorAll('input, textarea, select');
  inputs.forEach(input => {
    input.addEventListener('input', () => {
      clearError(input.id);
    });
  });

  // Add event listener for officer ID input
  if (officerIdInput) {
    officerIdInput.addEventListener('input', function(e) {
      autoFormatOfficerId(this);
    });
    
    officerIdInput.addEventListener('focus', function() {
      this.style.borderColor = '#254a93';
      this.style.boxShadow = '0 0 0 2px rgba(37, 74, 147, 0.1)';
    });
    
    officerIdInput.addEventListener('blur', function() {
      this.style.borderColor = '#ddd';
      this.style.boxShadow = 'none';
      
      // Validate format on blur
      const value = this.value.trim();
      if (value) {
        const validation = validateOfficerIdFormat(value);
        if (!validation.isValid) {
          showError('officerId', validation.message);
        }
      }
    });
    
    // Add paste handler
    officerIdInput.addEventListener('paste', function(e) {
      setTimeout(() => {
        autoFormatOfficerId(this);
      }, 10);
    });
    
    // Initialize format hint
    updateFormatHint(officerIdInput.value);
  }

  // Add date validation for enlistment and promotion
  const enlistmentDateInput = document.getElementById('date_of_enlistment');
  const promotionDateInput = document.getElementById('date_of_promotion');
  
  if (enlistmentDateInput) {
    enlistmentDateInput.addEventListener('change', function() {
      const today = new Date().toISOString().split('T')[0];
      if (this.value > today) {
        showError('date_of_enlistment', 'Date of enlistment cannot be in the future');
      } else {
        clearError('date_of_enlistment');
      }
      
      // Validate promotion date if both are set
      if (promotionDateInput && promotionDateInput.value) {
        if (promotionDateInput.value < this.value) {
          showError('date_of_promotion', 'Promotion date must be after enlistment date');
        } else {
          clearError('date_of_promotion');
        }
      }
    });
  }
  
  if (promotionDateInput) {
    promotionDateInput.addEventListener('change', function() {
      const today = new Date().toISOString().split('T')[0];
      if (this.value > today) {
        showError('date_of_promotion', 'Promotion date cannot be in the future');
        return;
      }
      
      // Validate against enlistment date
      if (enlistmentDateInput && enlistmentDateInput.value) {
        if (this.value < enlistmentDateInput.value) {
          showError('date_of_promotion', 'Promotion date must be after enlistment date');
        } else {
          clearError('date_of_promotion');
        }
      }
    });
  }

  // Initialize
  console.log("Marshal Core of Nigeria - Existing Officer Verification portal loaded successfully");
  console.log("Backend URL:", API_BASE_URL);
  console.log("New Officer ID Format: PREFIX/ALPHANUMERIC/INTAKE");
  console.log("New Upload System: Passport + Consolidated PDF (10 documents in one)");
};
</script>
</body>
</html>