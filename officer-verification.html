<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Marshal Core | Officer Verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: "Open Sans", sans-serif;
      background-color: #fffcf4;
      margin: 0;
      padding: 0;
    }

    .layout_padding {
      padding: 75px 0;
    }

    .footer_section {
      background-color: #254a93;
      color: #fff;
      text-align: center;
      padding: 20px 0;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }

    .contact_form-container input,
    .contact_form-container textarea,
    .contact_form-container select {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .contact_form-container button {
      background-color: #254a93;
      color: #fff;
      border: none;
      padding: 15px 30px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 18px;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-top: 20px;
      width: 100%;
    }

    .contact_form-container button:hover {
      background-color: #1a3570;
    }

    .header-container {
      background-color: #d32f2f;
      color: #fff;
      position: relative;
      padding: 20px 40px;
    }

    .header-logo {
      position: absolute;
      top: 20px;
      left: 40px;
    }

    .header-logo img {
      height: 110px;
      max-width: 200px;
      width: auto;
      object-fit: contain;
      filter: brightness(1.4) contrast(1.2);
      display: block;
    }

    .header-rc {
      position: absolute;
      top: 20px;
      right: 40px;
      font-size: 18px;
      font-weight: bold;
      color: #ffffff;
    }

    .header-title {
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      padding-top: 50px;
      padding-bottom: 10px;
      color: #ffffff;
    }

    .header-subtitle {
      text-align: center;
      font-size: 1.2rem;
      padding-bottom: 20px;
      color: #ffffff;
    }

    @media (max-width: 768px) {
      .header-logo,
      .header-rc {
        position: static;
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
      }

      .header-title {
        font-size: 1.5rem;
        padding: 10px 0;
      }

      .header-subtitle {
        font-size: 1rem;
        padding: 10px 0;
      }

      .header-logo img {
        height: 60px;
      }
    }

    .page-loader {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      font-size: 1.2rem;
      font-weight: bold;
      color: #1f233e;
    }
    
    .section-container {
      display: none;
    }
    
    .active-section {
      display: block;
    }
    
    #verificationMessage {
      color: #d32f2f;
      margin-top: 10px;
      text-align: center;
      font-weight: bold;
    }
    
    .success-message {
      color: green;
      margin-top: 10px;
      font-weight: bold;
    }
    
    .error-message {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }

    .status-message {
      background-color: #f8f9fa;
      border-left: 4px solid #254a93;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    .verification-banner {
      background-color: #d32f2f;
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }

    .verification-banner h3 {
      margin-top: 0;
      font-size: 1.5rem;
    }

    .verification-banner p {
      margin-bottom: 0;
      font-size: 1rem;
    }

    /* Form styling */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }

    .form-group label.required::after {
      content: " *";
      color: #d32f2f;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-col {
      flex: 1;
      min-width: 300px;
    }

    .file-upload-container {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin-top: 10px;
      background-color: #f9f9f9;
    }

    .file-upload-container input[type="file"] {
      display: block;
      margin: 10px auto;
      padding: 10px;
    }

    .file-upload-container .file-info {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }

    .password-match {
      color: green;
      font-size: 14px;
      margin-top: 5px;
    }

    .password-mismatch {
      color: red;
      font-size: 14px;
      margin-top: 5px;
    }

    .form-section {
      background-color: white;
      border-radius: 8px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .form-section h3 {
      color: #d32f2f;
      margin-top: 0;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
    }

    .instructions {
      background-color: #e8f4fd;
      border-left: 4px solid #254a93;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .instructions h4 {
      margin-top: 0;
      color: #254a93;
    }

    .instructions ul {
      margin: 10px 0;
      padding-left: 20px;
    }

    .instructions li {
      margin-bottom: 5px;
    }

    /* Terms & Conditions Styling */
    .terms-container {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }

    .terms-content {
      font-size: 14px;
      line-height: 1.6;
      color: #333;
    }

    .terms-content h4 {
      color: #d32f2f;
      margin-top: 15px;
      margin-bottom: 10px;
    }

    .terms-content ul {
      padding-left: 20px;
      margin: 10px 0;
    }

    .terms-content li {
      margin-bottom: 8px;
    }

    .terms-checkbox {
      display: flex;
      align-items: flex-start;
      margin: 20px 0;
      padding: 15px;
      background-color: #f0f8ff;
      border-radius: 8px;
      border: 1px solid #cce7ff;
    }

    .terms-checkbox input[type="checkbox"] {
      margin-right: 12px;
      margin-top: 4px;
      transform: scale(1.2);
    }

    .terms-checkbox label {
      font-weight: normal;
      cursor: pointer;
      line-height: 1.5;
    }

    .terms-checkbox label a {
      color: #254a93;
      text-decoration: underline;
      font-weight: bold;
    }

    .terms-checkbox label a:hover {
      color: #d32f2f;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #d32f2f;
    }

    .modal-header h3 {
      color: #d32f2f;
      margin: 0;
    }

    .close-modal {
      background: #d32f2f;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-modal:hover {
      background: #b71c1c;
    }

    .modal-body {
      line-height: 1.6;
    }

    .modal-body h4 {
      color: #254a93;
      margin-top: 20px;
      margin-bottom: 10px;
    }

    .modal-body ul {
      padding-left: 20px;
      margin: 10px 0;
    }

    .modal-body li {
      margin-bottom: 8px;
    }

    .read-more-btn {
      background: none;
      border: none;
      color: #254a93;
      text-decoration: underline;
      cursor: pointer;
      font-weight: bold;
      padding: 0;
      margin-left: 5px;
    }

    .read-more-btn:hover {
      color: #d32f2f;
    }

    .btn-disabled {
      background-color: #cccccc !important;
      cursor: not-allowed !important;
    }
    
    .error-field {
      border-color: #d32f2f !important;
      background-color: #fff5f5;
    }
    
    .error-message-small {
      color: #d32f2f;
      font-size: 12px;
      margin-top: 5px;
      display: block;
    }
    
    .id-format-hint {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      display: block;
    }
    
    .id-prefix-badge {
      display: inline-block;
      background-color: #e8f4fd;
      border: 1px solid #254a93;
      border-radius: 4px;
      padding: 2px 6px;
      margin: 0 2px;
      font-size: 11px;
      font-weight: bold;
      color: #254a93;
    }
    
    .prefix-info {
      background-color: #f0f8ff;
      border-left: 4px solid #254a93;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .prefix-info h4 {
      margin-top: 0;
      margin-bottom: 8px;
      color: #254a93;
    }
    
    .prefix-info ul {
      margin: 5px 0;
      padding-left: 20px;
    }
    
    .prefix-info li {
      margin-bottom: 3px;
    }
  </style>
</head>
<body>

<header class="header-container">
  <div class="header-logo">
    <img src="images/logo.png" alt="Marshal Core Logo">
  </div>
  <div class="header-rc">
    YA/CLB/10100
  </div>
  <div class="header-title">
    Marshal Core Officer Verification Portal
  </div>
  <div class="header-subtitle">
    For Existing Officers Only - No Payment Required
  </div>
</header>

<!-- OFFICER VERIFICATION SECTION -->
<section class="layout_padding section-container active-section" id="verificationSection">
  <div class="container">
    <div class="verification-banner">
      <h3>üîç Officer Verification Required</h3>
      <p>As an existing officer, please verify your identity before proceeding with registration.</p>
    </div>
    
    <div class="form-section">
      <h2>Step 1: Officer Verification</h2>
      
      <div class="prefix-info">
        <h4>üìã Valid Officer ID Formats:</h4>
        <ul>
          <li><span class="id-prefix-badge">MCN</span> - Marshal Core Nigeria (e.g., MCN/001/2024)</li>
          <li><span class="id-prefix-badge">MBT</span> - Marshal Board of Trustees (e.g., MBT/005/2023)</li>
          <li><span class="id-prefix-badge">MBC</span> - Marshal Board Committee (e.g., MBC/003/2022)</li>
        </ul>
        <p><strong>Format:</strong> PREFIX/NUMBER/YEAR (slashes will be auto-inserted)</p>
      </div>
      
      <div id="statusMessage" class="status-message" style="display: none;"></div>
      <form id="verificationForm" class="contact_form-container">
        <div class="form-row">
          <div class="form-col">
            <label for="officerId" class="required">Officer ID / Service Number</label>
            <input type="text" id="officerId" placeholder="MCN/001/2024" required 
                   pattern="^(MCN|MBT|MBC)/\d{1,4}/\d{4}$"
                   title="Format: MCN/001/2024, MBT/005/2023, or MBC/003/2022" />
            <span id="officerIdError" class="error-message-small"></span>
            <span class="id-format-hint">Type MCN, MBT, or MBC followed by numbers - slashes will auto-insert</span>
          </div>
          <div class="form-col">
            <label for="officerEmail" class="required">Official Email Address</label>
            <input type="email" id="officerEmail" placeholder="Enter your official email" required />
            <span id="officerEmailError" class="error-message-small"></span>
            <span class="id-format-hint">Use a professional email address (Gmail, Yahoo, etc.)</span>
          </div>
        </div>
        <button type="submit" id="verifyBtn">Verify Officer Identity</button>
      </form>
      <p id="verificationMessage"></p>
    </div>
  </div>
</section>

<!-- APPLICATION FORM SECTION -->
<section class="layout_padding section-container" id="applicationFormSection">
  <div class="container">
    <div class="verification-banner" style="background-color: #4CAF50;">
      <h3>‚úÖ Officer Verified Successfully!</h3>
      <p id="verifiedCategoryMessage">Please complete your registration form below. Fields marked with * are required.</p>
    </div>

    <div class="form-section">
      <h2>Step 2: Officer Registration Form</h2>
      <div class="instructions">
        <h4>üìã Instructions:</h4>
        <ul>
          <li>Fill in all required fields marked with *</li>
          <li>Use strong password (minimum 8 characters)</li>
          <li>Ensure all information is accurate</li>
          <li>Your Officer ID: <strong id="displayOfficerId"></strong></li>
        </ul>
      </div>

      <form id="applicationForm">

        <!-- Personal Information Section -->
        <div class="form-section">
          <h3>üìù Personal Information</h3>
          <div class="form-row">
            <div class="form-col">
              <label for="surname" class="required">Surname *</label>
              <input type="text" id="surname" name="surname" placeholder="Enter your surname" required />
              <span id="surnameError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="first_name" class="required">First Name *</label>
              <input type="text" id="first_name" name="first_name" placeholder="Enter your first name" required />
              <span id="firstNameError" class="error-message-small"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <label for="other_name">Other Name (Optional)</label>
              <input type="text" id="other_name" name="other_name" placeholder="Enter your other name" />
            </div>
            <div class="form-col">
              <label for="date_of_birth" class="required">Date of Birth *</label>
              <input type="date" id="date_of_birth" name="date_of_birth" required />
              <span id="dobError" class="error-message-small"></span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <label for="residential_address" class="required">Residential Address *</label>
              <textarea id="residential_address" name="residential_address" rows="3" placeholder="Enter your full residential address" required></textarea>
              <span id="addressError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="id_card_number" class="required">NIN Number *</label>
              <input type="text" id="id_card_number" name="id_card_number" placeholder="Enter your NIN number" required 
                     pattern="^\d{11}$" title="NIN must be 11 digits" />
              <span id="ninError" class="error-message-small"></span>
            </div>
          </div>
        </div>

        <!-- Contact Information Section -->
        <div class="form-section">
          <h3>üìû Contact Information</h3>
          <div class="form-row">
            <div class="form-col">
              <label for="email_address">Email Address</label>
              <input type="email" id="email_address" name="email_address" placeholder="Enter your email address" readonly />
            </div>
            <div class="form-col">
              <label for="mobile_number" class="required">Phone Number *</label>
              <input type="tel" id="mobile_number" name="mobile_number" placeholder="Enter your phone number" required 
                     pattern="^(\+234|0)\d{10}$" title="Format: +2348012345678 or 08012345678" />
              <span id="phoneError" class="error-message-small"></span>
              <span class="id-format-hint">Format: +2348012345678 or 08012345678</span>
            </div>
          </div>
        </div>

        <!-- Service Information Section -->
        <div class="form-section">
          <h3>üéñÔ∏è Service Information</h3>
          <div class="form-row">
            <div class="form-col">
              <label for="rank" class="required">Rank *</label>
              <select id="rank" name="rank" required>
                <option value="">Select Rank</option>
                <option value="Assistant Director General">Assistant Director General</option>
                <option value="Director">Director</option>
                <option value="Deputy Director">Deputy Director</option>
                <option value="Assistant Director">Assistant Director</option>
                <option value="Superintendent of Marshal">Superintendent of Marshal</option>
                <option value="Deputy Superintendent">Deputy Superintendent</option>
                <option value="Assistant Marshal Officer I">Assistant Marshal Officer I</option>
                <option value="Assistant Marshal Officer II">Assistant Marshal Officer II</option>
                <option value="Senior Marshal Officer">Senior Marshal Officer</option>
                <option value="Marshal Staff">Marshal Staff</option>
                <option value="Marshal Sergeant">Marshal Sergeant</option>
                <option value="Marshal Corporal">Marshal Corporal</option>
                <option value="Marshal Lance Corporal">Marshal Lance Corporal</option>
                <option value="Marshal Private">Marshal Private</option>
              </select>
              <span id="rankError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="appointment">Appointment (If Applicable)</label>
              <input type="text" id="appointment" name="appointment" placeholder="Enter your appointment" />
            </div>
          </div>
        </div>

        <!-- Account Security Section -->
        <div class="form-section">
          <h3>üîê Account Security</h3>
          <div class="form-row">
            <div class="form-col">
              <label for="password" class="required">Create Password *</label>
              <input type="password" id="password" name="password" placeholder="Create a strong password (min. 8 characters)" required 
                     minlength="8" />
              <span id="passwordError" class="error-message-small"></span>
            </div>
            <div class="form-col">
              <label for="confirm_password" class="required">Re-enter Password *</label>
              <input type="password" id="confirm_password" name="confirm_password" placeholder="Re-enter your password" required />
              <div id="passwordMatchMessage" class="password-mismatch"></div>
            </div>
          </div>
        </div>

        <!-- Additional Fields (for Pydantic model) -->
        <div style="display: none;">
          <input type="hidden" id="gender" name="gender" value="Male">
          <input type="hidden" id="place_of_birth" name="place_of_birth" value="">
          <input type="hidden" id="nationality" name="nationality" value="Nigerian">
          <input type="hidden" id="marital_status" name="marital_status" value="">
          <input type="hidden" id="state_of_residence" name="state_of_residence" value="">
          <input type="hidden" id="local_government_residence" name="local_government_residence" value="">
          <input type="hidden" id="country_of_residence" name="country_of_residence" value="Nigeria">
          <input type="hidden" id="state_of_origin" name="state_of_origin" value="">
          <input type="hidden" id="local_government_origin" name="local_government_origin" value="">
          <input type="hidden" id="years_of_service" name="years_of_service" value="">
          <input type="hidden" id="religion" name="religion" value="">
          <input type="hidden" id="additional_skills" name="additional_skills" value="">
          <input type="hidden" id="bank_name" name="bank_name" value="">
          <input type="hidden" id="account_number" name="account_number" value="">
        </div>

        <!-- TERMS & CONDITIONS SECTION -->
        <div class="form-section">
          <h3>üìú Terms & Conditions Agreement</h3>
          
          <div class="terms-container">
            <div class="terms-content" id="termsContent">
              <h4>Marshal Core of Nigeria - Terms of Service</h4>
              <p><strong>Effective Date:</strong> March 19, 2025</p>
              
              <h4>1. Acceptance of Terms</h4>
              <p>By registering as an officer of Marshal Core of Nigeria, you agree to be bound by these Terms of Service and all applicable laws and regulations.</p>
              
              <h4>2. Officer Responsibilities</h4>
              <ul>
                <li>Maintain the highest standards of discipline and professionalism</li>
                <li>Protect lives and property in accordance with Nigerian laws</li>
                <li>Uphold the integrity and reputation of Marshal Core at all times</li>
                <li>Participate in training and development programs as required</li>
                <li>Report any misconduct or security breaches immediately</li>
              </ul>
              
              <h4>3. Code of Conduct</h4>
              <ul>
                <li>Zero tolerance for corruption, bribery, or unethical behavior</li>
                <li>Strict adherence to chain of command and organizational hierarchy</li>
                <li>Professional appearance and conduct at all times</li>
                <li>Confidentiality of sensitive information</li>
                <li>Respect for human rights and dignity</li>
              </ul>
              
              <h4>4. Consequences of Misconduct</h4>
              <p>Violation of these terms may result in:</p>
              <ul>
                <li>Immediate suspension or dismissal</li>
                <li>Legal prosecution under Nigerian law</li>
                <li>Forfeiture of benefits and privileges</li>
                <li>Disciplinary action including demotion or retraining</li>
              </ul>
              
              <h4>5. Property Return Agreement</h4>
              <p>Upon termination of service, all Marshal Core property including identification cards, uniforms, equipment, and documents must be returned within 7 days.</p>
              
              <p><em>By checking the box below, you acknowledge that you have read, understood, and agree to be bound by these Terms & Conditions.</em></p>
            </div>
          </div>
          
          <div class="terms-checkbox">
            <input type="checkbox" id="agreeTerms" name="agreeTerms" required />
            <label for="agreeTerms">
              I have read and agree to the Terms & Conditions of Marshal Core of Nigeria. 
              I understand the consequences of misconduct including dismissal and legal prosecution. 
              <button type="button" class="read-more-btn" onclick="openFullTerms()">Read Full Terms</button>
            </label>
          </div>
        </div>

        <!-- Hidden fields -->
        <input type="hidden" id="verified_officer_id" name="verified_officer_id" />
        <input type="hidden" id="verified_officer_email" name="verified_officer_email" />
        <input type="hidden" id="service_number" name="service_number" />

        <!-- Submit Button -->
        <div class="form-section" style="text-align: center; background-color: #f9f9f9;">
          <button type="submit" id="submitBtn" style="width: auto; padding: 15px 50px;">
            Submit Officer Registration
          </button>
          <p style="margin-top: 15px; color: #666; font-size: 14px;">
            By submitting, you confirm that all information provided is accurate and complete.
          </p>
        </div>

      </form>
    </div>
  </div>
</section>

<!-- Terms Modal -->
<div id="termsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>üìú Marshal Core of Nigeria - Full Terms & Conditions</h3>
      <button class="close-modal" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <h4>Complete Terms of Service Agreement</h4>
      
      <h4>Article 1: Definitions</h4>
      <p><strong>1.1</strong> "Marshal Core" refers to Marshal Core of Nigeria, a registered security organization.</p>
      <p><strong>1.2</strong> "Officer" refers to any registered member of Marshal Core of Nigeria.</p>
      <p><strong>1.3</strong> "Service" refers to duties performed under Marshal Core authority.</p>
      
      <h4>Article 2: Officer Obligations</h4>
      <p><strong>2.1</strong> All officers must maintain valid identification and certification.</p>
      <p><strong>2.2</strong> Officers shall undergo regular training and assessment.</p>
      <p><strong>2.3</strong> Compliance with all Nigerian laws and regulations is mandatory.</p>
      
      <h4>Article 3: Disciplinary Procedures</h4>
      <p><strong>3.1</strong> Minor infractions: Written warning and retraining.</p>
      <p><strong>3.2</strong> Major violations: Suspension without pay pending investigation.</p>
      <p><strong>3.3</strong> Criminal activities: Immediate dismissal and legal prosecution.</p>
      
      <h4>Article 4: Confidentiality</h4>
      <p><strong>4.1</strong> All operational information is classified.</p>
      <p><strong>4.2</strong> Unauthorized disclosure may result in prosecution.</p>
      <p><strong>4.3</strong> Social media posting about operations is prohibited.</p>
      
      <h4>Article 5: Benefits and Entitlements</h4>
      <p><strong>5.1</strong> Benefits are contingent on satisfactory service.</p>
      <p><strong>5.2</strong> Pension and gratuity governed by organizational policy.</p>
      <p><strong>5.3</strong> Medical coverage requires active service status.</p>
      
      <h4>Article 6: Termination</h4>
      <p><strong>6.1</strong> Voluntary resignation requires 30 days notice.</p>
      <p><strong>6.2</strong> Dismissal for cause is immediate.</p>
      <p><strong>6.3</strong> All organizational property must be returned.</p>
      
      <h4>Article 7: Legal Jurisdiction</h4>
      <p><strong>7.1</strong> These terms are governed by Nigerian law.</p>
      <p><strong>7.2</strong> Disputes shall be settled in Edo State courts.</p>
      <p><strong>7.3</strong> Officer agrees to submit to Nigerian legal jurisdiction.</p>
      
      <div class="terms-checkbox" style="margin-top: 30px;">
        <input type="checkbox" id="modalAgree" name="modalAgree" />
        <label for="modalAgree">I have read and understand the full Terms & Conditions</label>
      </div>
      
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="closeModal()" style="background: #d32f2f; color: white; border: none; padding: 10px 30px; border-radius: 5px; cursor: pointer;">
          Close and Return to Form
        </button>
      </div>
    </div>
  </div>
</div>

<footer class="footer_section">
  <div class="container">
    <p>&copy; 2025 Marshal Core Of Nigeria Limited. <br>All rights reserved.</p>
  </div>
</footer>

<div class="page-loader" id="pageLoader">Loading...</div>

<script>
window.onload = () => {
  const verificationForm = document.getElementById("verificationForm");
  const applicationForm = document.getElementById("applicationForm");
  const pageLoader = document.getElementById("pageLoader");
  const statusMessage = document.getElementById("statusMessage");
  const verificationMessage = document.getElementById("verificationMessage");
  const verifyBtn = document.getElementById("verifyBtn");
  const submitBtn = document.getElementById("submitBtn");
  const agreeTermsCheckbox = document.getElementById("agreeTerms");
  const passwordMatchMessage = document.getElementById("passwordMatchMessage");
  const displayOfficerId = document.getElementById("displayOfficerId");
  const verifiedCategoryMessage = document.getElementById("verifiedCategoryMessage");
  const officerIdInput = document.getElementById("officerId");

  // Your backend URL
  const API_BASE_URL = 'https://backend-mcn-ltd.onrender.com';
  
  // Endpoints for existing officers
  const OFFICER_VERIFY_ENDPOINT = `${API_BASE_URL}/api/existing-officers/verify`;
  const OFFICER_REGISTER_ENDPOINT = `${API_BASE_URL}/api/existing-officers/register`;

  let verifiedOfficerId = "";
  let verifiedOfficerEmail = "";
  let officerCategory = "";

  // Modal functions
  function openFullTerms() {
    document.getElementById('termsModal').style.display = 'block';
  }

  function closeModal() {
    document.getElementById('termsModal').style.display = 'none';
  }

  // Close modal when clicking outside
  window.onclick = function(event) {
    const modal = document.getElementById('termsModal');
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }

  // Utility functions
  function showLoader() {
    pageLoader.style.display = "flex";
  }

  function hideLoader() {
    pageLoader.style.display = "none";
  }

  function showSection(sectionId) {
    document.querySelectorAll('.section-container').forEach(section => {
      section.classList.remove('active-section');
    });
    document.getElementById(sectionId).classList.add('active-section');
    window.scrollTo(0, 0);
  }

  function showError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const errorSpan = document.getElementById(`${fieldId}Error`);
    
    if (field) {
      field.classList.add('error-field');
    }
    
    if (errorSpan) {
      errorSpan.textContent = message;
      errorSpan.style.display = 'block';
    }
  }

  function clearError(fieldId) {
    const field = document.getElementById(fieldId);
    const errorSpan = document.getElementById(`${fieldId}Error`);
    
    if (field) {
      field.classList.remove('error-field');
    }
    
    if (errorSpan) {
      errorSpan.textContent = '';
      errorSpan.style.display = 'none';
    }
  }

  function clearAllErrors() {
    const errorSpans = document.querySelectorAll('.error-message-small');
    errorSpans.forEach(span => {
      span.textContent = '';
      span.style.display = 'none';
    });
    
    const errorFields = document.querySelectorAll('.error-field');
    errorFields.forEach(field => {
      field.classList.remove('error-field');
    });
  }

  function showVerificationMessage(message, isError = false) {
    verificationMessage.textContent = message;
    verificationMessage.style.color = isError ? 'red' : 'green';
    verificationMessage.className = isError ? 'error-message' : 'success-message';
  }

  // Password match validation
  function validatePasswordMatch() {
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm_password").value;
    
    if (password === "" && confirmPassword === "") {
      passwordMatchMessage.textContent = "";
      passwordMatchMessage.className = "";
      return false;
    }
    
    if (password === confirmPassword) {
      passwordMatchMessage.textContent = "‚úì Passwords match";
      passwordMatchMessage.className = "password-match";
      return true;
    } else {
      passwordMatchMessage.textContent = "‚úó Passwords do not match";
      passwordMatchMessage.className = "password-mismatch";
      return false;
    }
  }

  // Add event listeners for password validation
  document.getElementById("password").addEventListener('input', validatePasswordMatch);
  document.getElementById("confirm_password").addEventListener('input', validatePasswordMatch);

  // Enhanced fetch with better error handling
  async function makeRequest(url, options = {}) {
    const defaultOptions = {
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
      },
      credentials: 'include',
    };

    const mergedOptions = {
      ...defaultOptions,
      ...options,
      headers: {
        ...defaultOptions.headers,
        ...options.headers,
      },
    };

    try {
      const response = await fetch(url, mergedOptions);
      
      // Parse response
      let data;
      const contentType = response.headers.get('content-type');
      if (contentType && contentType.includes('application/json')) {
        data = await response.json();
      } else {
        const text = await response.text();
        data = { text: text, status: response.status };
      }

      return {
        ok: response.ok,
        status: response.status,
        data: data
      };
      
    } catch (error) {
      console.error('Request failed:', error);
      return {
        ok: false,
        status: 0,
        data: { detail: 'Network error. Please check your internet connection.' }
      };
    }
  }

  // Validate email format
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Validate required fields
  function validateForm(formId) {
    const form = document.getElementById(formId);
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;

    requiredFields.forEach(field => {
      if (!field.value.trim()) {
        showError(field.id, 'This field is required');
        isValid = false;
      } else {
        clearError(field.id);
        
        // Additional validation for specific fields
        if (field.type === 'email' && !isValidEmail(field.value)) {
          showError(field.id, 'Please enter a valid email address');
          isValid = false;
        }
        
        if (field.id === 'password' && field.value.length < 8) {
          showError(field.id, 'Password must be at least 8 characters long');
          isValid = false;
        }
        
        // Validate officer ID format
        if (field.id === 'officerId') {
          const isValidId = validateOfficerIdFormat(field.value);
          if (!isValidId.isValid) {
            showError(field.id, isValidId.message);
            isValid = false;
          }
        }
      }
    });

    return isValid;
  }

  // **FIXED: Validate officer ID format - SIMPLIFIED VERSION**
  function validateOfficerIdFormat(id) {
    if (!id || id.trim() === '') {
      return {
        isValid: false,
        message: 'Officer ID is required'
      };
    }
    
    id = id.trim().toUpperCase();
    
    // Check if it starts with valid prefix
    const validPrefixes = ['MCN', 'MBT', 'MBC'];
    const prefix = id.substring(0, 3);
    
    if (!validPrefixes.includes(prefix)) {
      return {
        isValid: false,
        message: 'Invalid prefix. Must start with MCN, MBT, or MBC'
      };
    }
    
    // Check if it contains at least one slash
    if (!id.includes('/')) {
      return {
        isValid: false,
        message: 'Format: PREFIX/NUMBER/YEAR (e.g., MCN/001/2024)'
      };
    }
    
    // Split by slashes
    const parts = id.split('/');
    
    if (parts.length < 3) {
      return {
        isValid: false,
        message: 'Format: PREFIX/NUMBER/YEAR (e.g., MCN/001/2024)'
      };
    }
    
    // Check prefix
    if (parts[0] !== prefix) {
      return {
        isValid: false,
        message: 'Invalid prefix format'
      };
    }
    
    // Check number (1-4 digits)
    const numberPart = parts[1];
    if (!numberPart || !/^\d{1,4}$/.test(numberPart)) {
      return {
        isValid: false,
        message: 'Number must be 1-4 digits (e.g., 001 or 1234)'
      };
    }
    
    // Check year (4 digits)
    const yearPart = parts[2];
    if (!yearPart || !/^\d{4}$/.test(yearPart)) {
      return {
        isValid: false,
        message: 'Year must be 4 digits (e.g., 2024)'
      };
    }
    
    // Validate year range
    const year = parseInt(yearPart);
    const currentYear = new Date().getFullYear();
    
    if (year < 2000 || year > currentYear) {
      return {
        isValid: false,
        message: `Year must be between 2000 and ${currentYear}`
      };
    }
    
    return { 
      isValid: true, 
      message: 'Valid ID format',
      formattedId: `${parts[0]}/${numberPart}/${yearPart}`
    };
  }

  // **FIXED: SIMPLE auto-formatting that doesn't restrict input**
  function autoFormatOfficerId(input) {
    let value = input.value.toUpperCase();
    let cursorPos = input.selectionStart;
    
    // Save original cursor position
    const originalCursorPos = cursorPos;
    
    // Only allow letters, numbers, and slashes
    value = value.replace(/[^A-Z0-9\/]/g, '');
    
    // If user types a valid prefix without slash, auto-add it
    if (value.length === 3 && ['MCN', 'MBT', 'MBC'].includes(value)) {
      // Don't auto-add slash if user just typed the prefix
      // Let them type the slash themselves
    }
    
    // If we have a prefix and at least 4 characters, check for slash after prefix
    if (value.length >= 4 && ['MCN', 'MBT', 'MBC'].includes(value.substring(0, 3))) {
      // If no slash after prefix and user typed something after prefix, suggest format
      if (value[3] !== '/') {
        // Show format hint but don't auto-insert
        // This is just visual feedback
      }
    }
    
    // Update the input value
    input.value = value;
    
    // Try to restore cursor position
    setTimeout(() => {
      input.setSelectionRange(cursorPos, cursorPos);
    }, 0);
    
    // Clear any error
    clearError('officerId');
    
    // Show format hint
    updateFormatHint(value);
  }

  // Update format hint based on current input
  function updateFormatHint(value) {
    const hintElement = document.querySelector('.id-format-hint');
    if (!hintElement) return;
    
    value = value.toUpperCase();
    
    if (value.length === 0) {
      hintElement.textContent = 'Type MCN, MBT, or MBC followed by numbers - slashes will auto-insert';
      hintElement.style.color = '#666';
    } else if (value.length >= 1 && value.length <= 3) {
      const currentText = value.substring(0, 3);
      if (['M', 'MC', 'MCN', 'MB', 'MBT', 'MBC'].includes(currentText)) {
        hintElement.textContent = `Continue with ${currentText}/number/year format`;
        hintElement.style.color = '#4CAF50';
      } else {
        hintElement.textContent = 'Must start with MCN, MBT, or MBC';
        hintElement.style.color = '#d32f2f';
      }
    } else if (value.length > 3) {
      if (value.includes('/')) {
        const parts = value.split('/');
        if (parts.length === 1) {
          hintElement.textContent = 'Add /number/year (e.g., /001/2024)';
          hintElement.style.color = '#4CAF50';
        } else if (parts.length === 2) {
          hintElement.textContent = 'Add /year (e.g., /2024)';
          hintElement.style.color = '#4CAF50';
        } else if (parts.length >= 3) {
          hintElement.textContent = 'Format looks good!';
          hintElement.style.color = '#4CAF50';
        }
      } else {
        hintElement.textContent = 'Add slash after prefix (e.g., MCN/)';
        hintElement.style.color = '#FF9800';
      }
    }
  }

     // **FIXED: Handle officer ID input - SIMPLIFIED**
  if (officerIdInput) {
    // Keep input handler for formatting hints
    officerIdInput.addEventListener('input', function(e) {
      autoFormatOfficerId(this);
    });
    
    // Add focus/blur for better UX
    officerIdInput.addEventListener('focus', function() {
      this.style.borderColor = '#254a93';
      this.style.boxShadow = '0 0 0 2px rgba(37, 74, 147, 0.1)';
    });
    
    officerIdInput.addEventListener('blur', function() {
      this.style.borderColor = '#ddd';
      this.style.boxShadow = 'none';
      
      // Validate format on blur
      const value = this.value.trim();
      if (value) {
        const validation = validateOfficerIdFormat(value);
        if (!validation.isValid) {
          showError('officerId', validation.message);
        }
      }
    });
    
    // Add paste handler
    officerIdInput.addEventListener('paste', function(e) {
      // Allow paste, then format
      setTimeout(() => {
        autoFormatOfficerId(this);
      }, 10);
    });
  }

  // Handle officer verification
  verificationForm.addEventListener("submit", async function(e) {
    e.preventDefault();
    
    clearAllErrors();
    showVerificationMessage("");
    
    if (!validateForm('verificationForm')) {
      return;
    }

    const officerId = document.getElementById("officerId").value.trim().toUpperCase();
    const officerEmail = document.getElementById("officerEmail").value.trim().toLowerCase();

    // Format officer ID before sending
    const validation = validateOfficerIdFormat(officerId);
    if (!validation.isValid) {
      showError('officerId', validation.message);
      return;
    }
    
    // Use formatted ID if available
    const formattedOfficerId = validation.formattedId || officerId;

    try {
      verifyBtn.disabled = true;
      verifyBtn.innerHTML = 'Verifying...';
      showLoader();
      
      const response = await makeRequest(OFFICER_VERIFY_ENDPOINT, {
        method: "POST",
        body: JSON.stringify({ 
          officer_id: formattedOfficerId, 
          email: officerEmail 
        })
      });

      if (response.ok) {
        verifiedOfficerId = formattedOfficerId;
        verifiedOfficerEmail = officerEmail;
        officerCategory = response.data.category || '';
        
        // Store in hidden fields
        document.getElementById("verified_officer_id").value = formattedOfficerId;
        document.getElementById("verified_officer_email").value = officerEmail;
        document.getElementById("service_number").value = formattedOfficerId;
        
        // Display officer ID in the form
        if (displayOfficerId) {
          displayOfficerId.textContent = formattedOfficerId;
        }
        
        // Update category message
        if (verifiedCategoryMessage && officerCategory) {
          verifiedCategoryMessage.innerHTML = `‚úÖ <strong>${officerCategory}</strong> Officer Verified Successfully!<br>Please complete your registration form below. Fields marked with * are required.`;
        }
        
        // Pre-fill email in form
        const emailField = document.getElementById("email_address");
        if (emailField) {
          emailField.value = officerEmail;
        }
        
        showVerificationMessage(`‚úÖ ${officerCategory || 'Officer'} verified successfully! Loading registration form...`, false);
        
        // Show registration form after delay
        setTimeout(() => {
          showSection("applicationFormSection");
          showVerificationMessage(""); // Clear message
        }, 1500);
        
      } else {
        let errorMessage = "‚ùå Officer verification failed. ";
        
        if (response.status === 409) {
          errorMessage += "Officer already registered in the system.";
        } else if (response.status === 404) {
          errorMessage += "Officer credentials not found in legacy system.";
        } else if (response.status === 400) {
          if (response.data && response.data.detail) {
            errorMessage += response.data.detail;
          } else {
            errorMessage += "Invalid input format.";
          }
        } else if (response.data && response.data.detail) {
          errorMessage += response.data.detail;
        } else {
          errorMessage += "Please check your credentials and try again.";
        }
        
        showVerificationMessage(errorMessage, true);
      }
      
    } catch (error) {
      console.error("Officer verification error:", error);
      showVerificationMessage("‚ùå Network error. Please check your connection and try again.", true);
      
    } finally {
      verifyBtn.disabled = false;
      verifyBtn.innerHTML = 'Verify Officer Identity';
      hideLoader();
    }
  });

  // Handle officer registration
  applicationForm.addEventListener("submit", async function(e) {
    e.preventDefault();
    
    clearAllErrors();
    
    // Validate Terms & Conditions
    if (!agreeTermsCheckbox.checked) {
      alert("‚ùå You must agree to the Terms & Conditions to proceed.");
      agreeTermsCheckbox.focus();
      return;
    }

    // Validate passwords match
    if (!validatePasswordMatch()) {
      alert("‚ùå Passwords do not match. Please check and try again.");
      return;
    }

    // Check if officer was verified
    if (!verifiedOfficerId || !verifiedOfficerEmail) {
      alert("‚ùå Please complete officer verification first.");
      showSection("verificationSection");
      return;
    }

    // Get current date for date of birth validation
    const today = new Date();
    const dobInput = document.getElementById("date_of_birth").value;
    const dobDate = new Date(dobInput);
    const minDate = new Date(today.getFullYear() - 70, today.getMonth(), today.getDate());
    const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());

    if (dobDate > maxDate) {
      showError("date_of_birth", "You must be at least 18 years old.");
      return;
    }
    
    if (dobDate < minDate) {
      showError("date_of_birth", "Please enter a valid date of birth.");
      return;
    }

    // Validate all required fields
    if (!validateForm('applicationForm')) {
      return;
    }

    // Validate phone number format
    const phoneInput = document.getElementById("mobile_number").value;
    const phoneRegex = /^(\+234|0)\d{10}$/;
    if (!phoneRegex.test(phoneInput.replace(/\s/g, ''))) {
      showError("mobile_number", "Please enter a valid Nigerian phone number (+2348012345678 or 08012345678)");
      return;
    }

    // Validate NIN number (11 digits for Nigeria)
    const ninInput = document.getElementById("id_card_number").value;
    const ninRegex = /^\d{11}$/;
    if (!ninRegex.test(ninInput)) {
      showError("id_card_number", "NIN number must be exactly 11 digits");
      return;
    }

    // Collect form data for Pydantic model
    const formData = {
      officer_id: verifiedOfficerId,
      email: verifiedOfficerEmail,
      phone: phoneInput.replace(/\s/g, ''),
      password: document.getElementById("password").value,
      full_name: `${document.getElementById("surname").value.trim()} ${document.getElementById("first_name").value.trim()}`,
      nin_number: ninInput,
      gender: document.getElementById("gender").value,
      date_of_birth: document.getElementById("date_of_birth").value,
      place_of_birth: document.getElementById("place_of_birth").value || "Not specified",
      nationality: document.getElementById("nationality").value,
      marital_status: document.getElementById("marital_status").value || "Not specified",
      residential_address: document.getElementById("residential_address").value.trim(),
      state_of_residence: document.getElementById("state_of_residence").value || "Not specified",
      local_government_residence: document.getElementById("local_government_residence").value || "Not specified",
      country_of_residence: document.getElementById("country_of_residence").value,
      state_of_origin: document.getElementById("state_of_origin").value || "Not specified",
      local_government_origin: document.getElementById("local_government_origin").value || "Not specified",
      rank: document.getElementById("rank").value,
      position: document.getElementById("appointment").value.trim() || "Not specified",
      years_of_service: parseInt(document.getElementById("years_of_service").value) || 0,
      service_number: verifiedOfficerId,
      religion: document.getElementById("religion").value || "Not specified",
      additional_skills: document.getElementById("additional_skills").value || "None",
      bank_name: document.getElementById("bank_name").value || "Not specified",
      account_number: document.getElementById("account_number").value || "Not specified"
    };

    // Disable submit button and show loader
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Submitting...';
    submitBtn.classList.add('btn-disabled');
    showLoader();

    try {
      const response = await makeRequest(OFFICER_REGISTER_ENDPOINT, {
        method: "POST",
        body: JSON.stringify(formData)
      });

      if (response.ok) {
        // Success!
        const regId = response.data.registration_id || verifiedOfficerId;
        alert(`üéâ ${officerCategory || 'Officer'} Registration Successful!\n\nYour information has been saved to the database.\n\nRegistration ID: ${regId}\n\nYou can now login with your credentials.`);
        
        // Reset forms and go back to verification
        verificationForm.reset();
        applicationForm.reset();
        verifiedOfficerId = "";
        verifiedOfficerEmail = "";
        officerCategory = "";
        passwordMatchMessage.textContent = "";
        agreeTermsCheckbox.checked = false;
        if (displayOfficerId) displayOfficerId.textContent = "";
        showSection("verificationSection");
        
      } else {
        let errorMessage = "‚ùå Registration failed. ";
        
        if (response.status === 409) {
          errorMessage += "Officer with these credentials already exists.";
        } else if (response.data && response.data.detail) {
          errorMessage += response.data.detail;
        } else {
          errorMessage += "Please check your information and try again.";
        }
        
        alert(errorMessage);
      }
      
    } catch (error) {
      console.error("Registration error:", error);
      alert("‚ùå Network error during registration. Please check your connection and try again.");
      
    } finally {
      // Re-enable submit button
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Submit Officer Registration';
      submitBtn.classList.remove('btn-disabled');
      hideLoader();
    }
  });

  // Add input event listeners to clear errors when user types
  const inputs = document.querySelectorAll('input, textarea, select');
  inputs.forEach(input => {
    input.addEventListener('input', () => {
      clearError(input.id);
    });
  });

  // Initialize
  console.log("Officer verification portal loaded successfully");
  console.log("Backend URL:", API_BASE_URL);
  
  // Initialize format hint
  if (officerIdInput) {
    updateFormatHint(officerIdInput.value);
  }
};
</script>

</body>
</html>